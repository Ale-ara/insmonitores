<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Comprovações de Monitoria</title>
<style>
  body {
    margin:0;
    background:#0d1117;
    font-family: Arial, sans-serif;
    color:white;
  }

  /* LOADING */
  #loadingScreen {
    position:fixed;
    top:0; left:0;
    width:100%; height:100%;
    background:#0d1117;
    display:flex;
    align-items:center;
    justify-content:center;
    flex-direction:column;
    z-index:9999;
  }

  .loader {
    width:48px;
    height:48px;
    border:5px solid #1f6feb;
    border-top-color:transparent;
    border-radius:50%;
    animation:spin 1s linear infinite;
  }

  @keyframes spin {
    to { transform:rotate(360deg); }
  }

  #loadingScreen p {
    margin-top:14px;
    color:#8bb9ff;
    font-size:15px;
  }

  /* GRID DOS INSTRUTORES */
  #gridInstrutores {
    display:grid;
    grid-template-columns:repeat(auto-fill, minmax(180px, 1fr));
    gap:18px;
    padding:20px;
  }

  .pasta {
    background:#161b22;
    border-radius:10px;
    padding:15px;
    text-align:center;
    cursor:pointer;
    transition:.2s;
  }
  .pasta:hover { background:#1e2530; }
  .pasta img { width:64px; }

  /* VIEWER */
  #viewArea {
    display:none;
    padding:15px;
  }

  #largeImg {
    max-width:100%;
    border-radius:8px;
    margin-bottom:10px;
  }

  #metaTitle { font-size:18px; font-weight:bold; }
  #metaSub { color:#9da5b4; margin-bottom:12px; }

  #listaPrints {
    display:grid;
    grid-template-columns:repeat(auto-fill, minmax(200px,1fr));
    gap:15px;
    margin-top:20px;
  }

  .thumb {
    background:#161b22;
    padding:10px;
    border-radius:8px;
    cursor:pointer;
    transition:.2s;
  }
  .thumb:hover { background:#1e2530; }

  .thumb img {
    width:100%;
    height:140px;
    object-fit:cover;
    border-radius:6px;
  }

  .panel { 
    display:flex;
    gap:15px;
    padding:12px;
    background:#161b22;
    border-top:2px solid #1f6feb;
    overflow-x:auto;
  }

  .panel-card {
    display:flex;
    gap:10px;
    align-items:center;
    background:#1e2530;
    padding:8px 12px;
    border-radius:10px;
    white-space:nowrap;
  }

  .panel-card img {
    width:48px;
    height:48px;
    border-radius:6px;
  }

</style>
</head>
<body>

<!-- LOADING -->
<div id="loadingScreen">
  <div class="loader"></div>
  <p>Carregando dados...</p>
</div>

<h2 style="padding:15px;">Comprovações de Monitoria</h2>

<div id="gridInstrutores"></div>

<div id="viewArea">
  <img id="largeImg" src="">
  <div id="metaTitle"></div>
  <div id="metaSub"></div>
  <button onclick="openOriginal()">Abrir original</button>

  <h3 style="margin-top:25px;">Prints</h3>
  <div id="listaPrints"></div>
</div>

<div id="panelBottom" class="panel"></div>

<script>
// CONFIG
const API_URL = "https://script.google.com/macros/s/AKfycbxlq8ShJtWdo5rBRRj1iiAHzwQDpZ017dQsBxStIVuCG0zZH2oUDIn_m5s7jN-EvYAr/exec";

// refs
const loadingScreen = document.getElementById("loadingScreen");
const grid = document.getElementById("gridInstrutores");
const viewArea = document.getElementById("viewArea");
const listaPrints = document.getElementById("listaPrints");
const largeImg = document.getElementById("largeImg");
const metaTitle = document.getElementById("metaTitle");
const metaSub = document.getElementById("metaSub");
const panelBottom = document.getElementById("panelBottom");

let GLOBAL_DATA = [];

// UTIL
function el(tag, cls){ const d=document.createElement(tag); if(cls) d.className=cls; return d; }
function escapeHtml(s){ return s ? s.replace(/[&<>"']/g, x=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[x])) : ""; }

// LOAD
function carregarDados(){
  fetch(API_URL)
    .then(r=>r.json())
    .then(json=>{
      GLOBAL_DATA = json;
      renderPastas(json);
      loadingScreen.style.display = "none";
    })
    .catch(err=>{
      loadingScreen.innerHTML = "<p>Erro ao carregar dados.</p>";
      console.error(err);
    });
}

carregarDados();

// RENDER PASTAS
function renderPastas(list){
  grid.innerHTML = "";
  list.forEach(inst=>{
    const card = el("div","pasta");
    card.innerHTML = `
      <img src="https://cdn-icons-png.flaticon.com/512/716/716784.png">
      <h3>${escapeHtml(inst.instrutor)}</h3>
      <small>${inst.items.length} prints</small>
    `;
    card.onclick = ()=> abrirInstrutor(inst.instrutor);
    grid.appendChild(card);
  });
}

// ABRIR INSTRUTOR
function abrirInstrutor(nome){
  const inst = GLOBAL_DATA.find(i => i.instrutor === nome);
  if(!inst) return;

  viewArea.style.display = "block";

  mostrarPrint(inst, inst.items[0]);

  listaPrints.innerHTML = "";
  inst.items.forEach(it=>{
    const t = el("div","thumb");
    t.innerHTML = `
      <img src="${escapeHtml(it.print)}">
      <div class="txt"><strong>${escapeHtml(it.nickAluno)}</strong><br>
      <small>${escapeHtml(it.data)}</small></div>
    `;
    t.onclick = ()=> mostrarPrint(inst, it);
    listaPrints.appendChild(t);
  });

  renderPanel(inst);
}

// MOSTRAR PRINT
function mostrarPrint(inst, item){
  largeImg.src = item.print;
  metaTitle.innerText = `${inst.instrutor} • ${item.aluno}`;
  metaSub.innerText = `Data: ${item.data || "-"}`;
}

// PAINEL INFERIOR
function renderPanel(inst){
  panelBottom.innerHTML = "";

  const seen = new Set();

  inst.items.forEach(it=>{
    if(seen.has(it.nickAluno)) return;
    seen.add(it.nickAluno);

    const c = el("div","panel-card");
    c.innerHTML = `
      <img src="${escapeHtml(it.personagem)}">
      <div>
        <div class="nome">${escapeHtml(it.aluno)}</div>
        <div class="tipo">Aluno</div>
      </div>
    `;
    panelBottom.appendChild(c);
  });
}

function openOriginal(){
  window.open(largeImg.src, "_blank");
}
</script>

</body>
</html>
